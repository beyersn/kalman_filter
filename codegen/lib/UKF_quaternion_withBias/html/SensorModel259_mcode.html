<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,182" id="srcline182">182</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,183" id="srcline183">183</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S76T35U1119">Z_kkm1</span> = SensorModel(<span class="var type1" id="S77T28U1122">X_kkm1</span>, <span class="var type1" id="S78T1U1123">B_ref</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,184" id="srcline184">184</a></span><span class="line"><span class="comment">% This function propagates the sigma points through the sensor model to</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,185" id="srcline185">185</a></span><span class="line"><span class="comment">% obtain the transformed sigma points (Predicted Measurements).</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,186" id="srcline186">186</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,187" id="srcline187">187</a></span><span class="line"><span class="comment">% x_kkm1 is the propagated sigma points</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,188" id="srcline188">188</a></span><span class="line"><span class="comment">% B_ref is the reference frame magnetic field vector</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,189" id="srcline189">189</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,190" id="srcline190">190</a></span><span class="line"><span class="mxinfo" id="T35:U4"><span class="var type1" id="S76T35U1126">Z_kkm1</span> = <span class="mxinfo" id="T35:U6">zeros(<span class="mxinfo" id="T2:U7">6</span>,<span class="mxinfo" id="T2:U8">19</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,191" id="srcline191">191</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,192" id="srcline192">192</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S80T2U1133">idx</span> = <span class="mxinfo" id="T2:U10">1</span>:size(<span class="var type1" id="S77T28U1138">X_kkm1</span>,2)</span></span>
<span class="srcline"><span class="lineno"><a href="1,193" id="srcline193">193</a></span><span class="line">  </span></span>
<span class="srcline"><span class="lineno"><a href="1,194" id="srcline194">194</a></span><span class="line">    <span class="comment">% Magnetic Field Prediction</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,195" id="srcline195">195</a></span><span class="line">    <span class="mxinfo" id="T14:U12"><span class="var type1" id="S82T14U1142">Z_kkm1_temp</span> = <span class="mxinfo" id="T14:U14"><span class="fcn" id="F70N9:B1144">quatmultiply</span>(<span class="mxinfo" id="T14:U15"><span class="fcn" id="F70N9:B1146">quatmultiply</span>(<span class="mxinfo" id="T14:U16"><span class="fcn" id="F69N8:B1148">quatinv</span>(<span class="mxinfo" id="T14:U17"><span class="var type1" id="S77T28U1150">X_kkm1</span>(<span class="mxinfo" id="T15:U19"><span class="mxinfo" id="T2:U20">1</span>:<span class="mxinfo" id="T2:U21">4</span></span>,<span class="var type1" id="S80T2U1154">idx</span>)</span>)</span>, <span class="mxinfo" id="T14:U23">[<span class="mxinfo" id="T2:U24">0</span>; <span class="var type1" id="S78T1U1159">B_ref</span>]</span>)</span>, <span class="mxinfo" id="T14:U26"><span class="var type1" id="S77T28U1161">X_kkm1</span>(<span class="mxinfo" id="T15:U28"><span class="mxinfo" id="T2:U29">1</span>:<span class="mxinfo" id="T2:U30">4</span></span>,<span class="var type1" id="S80T2U1165">idx</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,196" id="srcline196">196</a></span><span class="line">    <span class="mxinfo" id="T1:U32"><span class="mxinfo" id="T1:U33"><span class="var type1" id="S76T35U1169">Z_kkm1</span>(<span class="mxinfo" id="T16:U35"><span class="mxinfo" id="T2:U36">1</span>:<span class="mxinfo" id="T2:U37">3</span></span>,<span class="var type1" id="S80T2U1173">idx</span>)</span> = <span class="mxinfo" id="T1:U39"><span class="var type1" id="S82T14U1175">Z_kkm1_temp</span>(<span class="mxinfo" id="T16:U41"><span class="mxinfo" id="T2:U42">2</span>:<span class="mxinfo" id="T2:U43">4</span></span>,<span class="mxinfo" id="T2:U44">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,197" id="srcline197">197</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,198" id="srcline198">198</a></span><span class="line">    <span class="comment">% Angular Velocity Prediction</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,199" id="srcline199">199</a></span><span class="line">    <span class="mxinfo" id="T1:U45"><span class="mxinfo" id="T1:U46"><span class="var type1" id="S76T35U1183">Z_kkm1</span>(<span class="mxinfo" id="T16:U48"><span class="mxinfo" id="T2:U49">4</span>:<span class="mxinfo" id="T2:U50">6</span></span>,<span class="var type1" id="S80T2U1187">idx</span>)</span> = <span class="mxinfo" id="T1:U52"><span class="mxinfo" id="T1:U53"><span class="var type1" id="S77T28U1190">X_kkm1</span>(<span class="mxinfo" id="T16:U55"><span class="mxinfo" id="T2:U56">5</span>:<span class="mxinfo" id="T2:U57">7</span></span>,<span class="var type1" id="S80T2U1194">idx</span>)</span> + <span class="mxinfo" id="T1:U59"><span class="var type1" id="S77T28U1196">X_kkm1</span>(<span class="mxinfo" id="T16:U61"><span class="mxinfo" id="T2:U62">8</span>:<span class="mxinfo" id="T2:U63">10</span></span>,<span class="var type1" id="S80T2U1200">idx</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,200" id="srcline200">200</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,201" id="srcline201">201</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,202" id="srcline202">202</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,203" id="srcline203">203</a></span><span class="line"></span></span>
</pre>
